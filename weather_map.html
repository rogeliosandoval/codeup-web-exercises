<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Weather Map</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css" integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">
    <link href='https://api.mapbox.com/mapbox-gl-js/v2.2.0/mapbox-gl.css' rel='stylesheet' />
</head>

<style>
    .card{
        background: yellow;
    }

    .list-group-item{
        background: darkgrey;
    }
</style>

<body>
<h1><center>Weather</center></h1>

<main class="row opa forecast container">
    <div class="d-flex flex-row justify-content-between flex-nowrap">

        <div class="container opa">
            <div class="card" style="width: 18rem;">
                <div class="card-header" id="weather-date0">
                    Today
                </div>
                <ul class="list-group list-group-flush">
                    <li class="list-group-item" id="high-low0">High Low Temp</li>
                    <li class="list-group-item" id="feelsLike0">Feels Like</li>
                    <li class="list-group-item" id="weather-humidity0">Humidity</li>
                    <li class="list-group-item" id="weather-condition0">Weather Description</li>
                </ul>
            </div>
        </div>

        <div class="container justify-content-between opa">
            <div class="card" style="width: 18rem;">
                <div class="card-header" id="weather-date1">
                    Today
                </div>
                <ul class="list-group list-group-flush">
                    <li class="list-group-item" id="high-low1">High Low Temp</li>
                    <li class="list-group-item" id="feelsLike1">Feels Like</li>
                    <li class="list-group-item" id="weather-humidity1">Humidity</li>
                    <li class="list-group-item" id="weather-condition1">Weather Description</li>
                </ul>
            </div>
        </div>

        <div class="container justify-content-between opa">
            <div class="card" style="width: 18rem;">
                <div class="card-header" id="weather-date2">
                    Today
                </div>
                <ul class="list-group list-group-flush">
                    <li class="list-group-item" id="high-low2">High Low Temp</li>
                    <li class="list-group-item" id="feelsLike2">Feels Like</li>
                    <li class="list-group-item" id="weather-humidity2">Humidity</li>
                    <li class="list-group-item" id="weather-condition2">Weather Description</li>
                </ul>
            </div>
        </div>

        <div class="container justify-content-between opa">
            <div class="card" style="width: 18rem;">
                <div class="card-header" id="weather-date3">
                    Today
                </div>
                <ul class="list-group list-group-flush">
                    <li class="list-group-item" id="high-low3">High Low Temp</li>
                    <li class="list-group-item" id="feelsLike3">Feels Like</li>
                    <li class="list-group-item" id="weather-humidity3">Humidity</li>
                    <li class="list-group-item" id="weather-condition3">Weather Description</li>
                </ul>
            </div>
        </div>
    </div>

    <section class="container row w-100 justify-content-center">
        <div id="geocoder" class="geocoders"></div>
        <div class="col-12 m-auto" id='map' style='width: 400px; height: 300px;'></div>
        <input type="text" id="address" name="location" placeholder="city, state">
        <button id="addressSubmit">Check Weather</button>
    </section>

</main>

<script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
<script src="js/keys.js"></script>
<script src="js/mapbox-geocoder-utils.js"></script>
<script src='https://api.mapbox.com/mapbox-gl-js/v2.2.0/mapbox-gl.js'></script>
<script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.53.0/mapbox-gl.js'></script>
<script>

    // var coordinates = [29.4241, -98.4936];
    // $.get("https://api.openweathermap.org/data/2.5/onecall?units=imperial&lat=" + coordinates[0] + "&lon=" + coordinates[1] + "&exclude=current,hourly,minutely&appid=" + WEATHER_MAP_TOKEN)
    //     .done(function (resp) {
    //         console.log(resp);
    //         var today = resp.daily[0];
    //         var todayDate = new Date(today.dt * 1000);
    //         console.log(todayDate);
    //     });

    mapboxgl.accessToken = MAPBOX_ACCESS_TOKEN;
    var map = new mapboxgl.Map({
        container: 'map', // container ID
        style: 'mapbox://styles/mapbox/streets-v11', // style URL
        center: [-98.4916, 29.4252], // starting position [lng, lat]
        zoom: 12 // starting zoom
    });

    let updatecard = function(data){
        for (let i =0; i < 4; i++) {
            console.log(data.daily[i]);
            /*Card Updates plus the number string + i*/
            $("#weather-date" + i).html(new Date(data.daily[i].dt * 1000).toDateString());
            $("#high-low" + i).html("Max Temp: " + data.daily[i].temp.max + "° / Min: " + data.daily[i].temp.min + "°");
            $("#feelsLike" + i).html("Feels like: " + data.daily[i].feels_like.day + "°");
            $("#weather-humidity" + i).html("Humidity: " + data.daily[i].humidity + "%");
            $("#weather-condition" + i).html(data.daily[i].weather[0].description);
        }
    }

        $.get("http://api.openweathermap.org/data/2.5/onecall", {
            APPID: WEATHER_MAP_TOKEN,
            lon: -98.4916,
            lat: 29.4252,
            units: "imperial"
        }).done(function (data) {
            console.log(data);

            updatecard(data);

        });

    var marker = new mapboxgl.Marker({
        color: 'red'
    })
        .setLngLat([-98.4916, 29.4252])
        .addTo(map);

    marker.setPopup(popup)

    marker.setDraggable(true);

    geocoder.on("result", function (location) {
        console.log(location);
        inputlong= location.result.center[0];
        inputlat=location.result.center[1];
        forecast(inputlong,inputlat);
    })

</script>
</body>
</html>